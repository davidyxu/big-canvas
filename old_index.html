<html>
<head>
<link href="big_canvas.css" rel="stylesheet" type="text/css">
<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js"></script>
<script>
	offsetX = 0
	offsetY = 0
  var socket = io.connect(window.location.hostname);
  fromX = null
  socket.on('connect', function(){
    // call the server-side function 'adduser' and send one parameter (value of prompt)
    console.log("connected")
  });

  socket.on('updatecanvas', function(data) {
  	context.beginPath();
		context.moveTo(data.fromX-offsetX, data.fromY-offsetY);
		context.lineTo(data.toX-offsetX, data.toY-offsetY);
		context.stroke();
		context.closePath();
  });

  $(function() {
  	context = $('canvas')[0].getContext("2d");
		context.strokeStyle = "red";
		context.lineWidth = 1.0;
		context.lineJoin = "round";

		$('canvas').mousedown(function(e) {
			console.log(e.clientX)
			fromX = e.clientX
			fromY = e.clientY
			console.log(e.clientY)
		});
		$('canvas').mousemove(function(e) {
			if (fromX) {
				toX = e.clientX
				toY = e.clientY
				socket.emit('draw', {
					fromX:fromX+offsetX,
					fromY:fromY+offsetY,
					toX: toX+offsetX,
					toY: toY+offsetY	
				})
				fromX = toX
				fromY = toY
			}
		});

		$(document).mouseup(function(e) {
			fromX = null;
			fromY = null;
		});

		$(document).keydown(function(e) {
			var pressedKey = e.which
			switch (pressedKey) {
				case 37:
					console.log("left");
					offsetX -= 10;
					break;
				case 38:
					console.log("up");
					offsetY += 10;
					break;
				case 39:
					console.log("right");
					offsetX += 10;
					break;
				case 40:
					console.log("down");
					offsetY -= 10;
					break;
			}
		});

  });
</script>
</head>
<body>
<canvas id="myCanvas" width="600" height="600"
style="border:1px solid #000000;">
</canvas>
</body>
</html>